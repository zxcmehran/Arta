if(typeof(Prototype)=="undefined"){throw"Control.Tabs requires Prototype to be loaded."}if(typeof(Object.Event)=="undefined"){throw"Control.Tabs requires Object.Event to be loaded."}Control.Tabs=Class.create({initialize:function(d,b){if(!$(d)){throw"Control.Tabs could not find the element: "+d}this.activeContainer=false;this.activeLink=false;this.containers=$H({});this.links=[];this.options={beforeChange:Prototype.emptyFunction,afterChange:Prototype.emptyFunction,hover:false,tracked:true,linkSelector:"li a",linkAttribute:"href",setClassOnContainer:false,activeClassName:"active",disabledClassName:"disabled",defaultTab:"first",autoLinkExternal:true,targetRegExp:/#(.+)$/,showFunction:Element.show,hideFunction:Element.hide};Object.extend(this.options,b||{});if(this.options.tracked){Control.Tabs.instances.push(this)}var c;switch(this.options.linkAttribute){case"href":case"src":c=function(e){return(/^#/).test(e.getAttribute(this.options.linkAttribute).replace(window.location.href.split("#")[0],""))};break;default:if(typeof(this.options.linkAttribute)=="function"){c=this.options.linkAttribute}else{c=function(e){return e.hasAttribute(this.options.linkAttribute)}}}(typeof(this.options.linkSelector)=="string"?$(d).select(this.options.linkSelector):this.options.linkSelector($(d))).findAll(c.bind(this)).each(function(e){this.addTab(e)}.bind(this));this.containers.values().each(Element.hide);if(this.options.defaultTab=="first"){this.setActiveTab(this.links.first())}else{if(this.options.defaultTab=="last"){this.setActiveTab(this.links.last())}else{this.setActiveTab(this.options.defaultTab)}}var a=this.options.targetRegExp.exec(window.location);if(a&&a[1]){a[1].split(",").each(function(e){this.setActiveTab(this.links.find(function(f){return f.key==e}))}.bind(this))}if(this.options.autoLinkExternal){$A(document.getElementsByTagName("a")).each(function(e){if(!this.links.include(e)){var f=e.href.replace(window.location.href.split("#")[0],"");if(f.substring(0,1)=="#"){if(this.containers.keys().include(f.substring(1))){$(e).observe("click",function(h,g){this.setActiveTab(g.substring(1))}.bindAsEventListener(this,f))}}}}.bind(this))}},addTab:function(b){this.links.push(b);switch(this.options.linkAttribute){case"href":case"src":b.key=b.getAttribute(this.options.linkAttribute).replace(window.location.href.split("#")[0],"").split("#").last().replace(/#/,"");break;default:if(typeof(this.options.linkAttribute)=="function"){b.key=this.options.linkAttribute(b)}else{b.key=b.getAttribute(this.options.linkAttribute)}}var a=this.options.tabs_container?this.options.tabs_container.down("#"+b.key):$(b.key);if(!a){throw"Control.Tabs: #"+b.key+" was not found on the page."}this.containers.set(b.key,a);b[this.options.hover?"onmouseover":"onclick"]=function(c){if(window.event){Event.stop(window.event)}this.setActiveTab(c);return false}.bind(this,b)},getTab:function(a){if(!a&&typeof(a)=="undefined"){return null}if(typeof(a)=="string"){return this.getTab(this.links.find(function(b){return b.key==a}))}else{if(typeof(a)=="number"){return this.getTab(this.links[a])}else{return this.containers.get(a.key)}}},setActiveTab:function(a){if(!a&&typeof(a)=="undefined"){return}if(typeof(a)=="string"){this.setActiveTab(this.links.find(function(b){return b.key==a}))}else{if(typeof(a)=="number"){this.setActiveTab(this.links[a])}else{if(!(this.options.setClassOnContainer?$(a.parentNode):a).hasClassName(this.options.disabledClassName)){if(a==this.activeLink){return}if(this.notify("beforeChange",this.activeContainer,this.containers.get(a.key))===false){return}if(this.activeContainer){this.options.hideFunction(this.activeContainer)}this.links.each(function(b){(this.options.setClassOnContainer?$(b.parentNode):b).removeClassName(this.options.activeClassName)}.bind(this));(this.options.setClassOnContainer?$(a.parentNode):a).addClassName(this.options.activeClassName);this.activeContainer=this.containers.get(a.key);this.activeLink=a;this.options.showFunction(this.containers.get(a.key));this.notify("afterChange",this.containers.get(a.key))}}}},disableTab:function(a){if(!a&&typeof(a)=="undefined"){return}if(typeof(a)=="string"){this.disableTab(this.links.find(function(b){return b.key==a}))}else{if(typeof(a)=="number"){this.disableTab(this.links[a])}else{if({INPUT:true,BUTTON:true,SELECT:true,TEXTAREA:true}[a.nodeName]){a.disabled=true}(this.options.setClassOnContainer?$(a.parentNode):a).addClassName(this.options.disabledClassName)}}},enableTab:function(a){if(!a&&typeof(a)=="undefined"){return}if(typeof(a)=="string"){this.enableTab(this.links.find(function(b){return b.key==a}))}else{if(typeof(a)=="number"){this.enableTab(this.links[a])}else{if({INPUT:true,BUTTON:true,SELECT:true,TEXTAREA:true}[a.nodeName]){a.disabled=false}(this.options.setClassOnContainer?$(a.parentNode):a).removeClassName(this.options.disabledClassName)}}},next:function(){this.links.each(function(b,a){if(this.activeLink==b&&this.links[a+1]){this.setActiveTab(this.links[a+1]);throw $break}}.bind(this))},previous:function(){this.links.each(function(b,a){if(this.activeLink==b&&this.links[a-1]){this.setActiveTab(this.links[a-1]);throw $break}}.bind(this))},first:function(){this.setActiveTab(this.links.first())},last:function(){this.setActiveTab(this.links.last())}});Object.extend(Control.Tabs,{instances:[],findByTabId:function(a){return Control.Tabs.instances.find(function(b){return b.links.find(function(c){return c.key==a})})}});Object.Event.extend(Control.Tabs);